hosts:
  deployer.org:
    remote_user: anton

config:
  banner: |
    ╭──────────────────────────────────────────────────────╮
    │                                                      │
    │   Update available! https://deployer.org/download    │
    │                                                      │
    ╰──────────────────────────────────────────────────────╯

tasks:
  update_manifest:
    - desc: Create a new record in manifest.json
    - cd: ~/deployer.org/artifacts
      run: "fx manifest.json '[...this, {name: `deployer.org`, sha1: `{{sha1}}`, url: `{{url}}`, version: `{{version}}`}]' save"

  release_dist:
    - desc: Release deployer/dist
    - cd: ~/dev/dist
      run: php update

  create_banner:
    - desc: Create an update banner
    - run: echo $'{{banner}}' > {{site}}/check-updates/{{old_version}}
